YUI.add("moodle-clickap_program-management",function(g,e){function t(){t.superclass.constructor.apply(this,arguments)}function s(e){t.superclass.constructor.apply(this,[e])}function i(){i.superclass.constructor.apply(this,arguments)}function n(){n.superclass.constructor.apply(this,arguments)}function o(){o.superclass.constructor.apply(this,arguments)}t.NAME="moodle-clickap_program-management",t.CSS_PREFIX="management",t.ATTRS={element:{setter:function(e){return"string"==typeof e&&(e=g.one("#"+e)),e}},categorylisting:{value:null},courselisting:{value:null},coursedetails:{value:null},activecategoryid:{value:null},activecourseid:{value:null},categories:{setter:function(e,t){if(g.Lang.isArray(e))return e;var i=this.get(t);return i.push(e),i},value:[]},courses:{validator:function(e){return g.Lang.isArray(e)},value:[]},page:{getter:function(e,t){return null===e&&(e=this.get("element").getData(t),this.set(t,e)),e},value:null},totalpages:{getter:function(e,t){return null===e&&(e=this.get("element").getData(t),this.set(t,e)),e},value:null},totalcourses:{getter:function(e,t){return null===e&&(e=this.get("element").getData(t),this.set(t,e)),e},value:null},ajaxurl:{getter:function(e){return null===e&&(e=M.cfg.wwwroot+"/admin/clickap/program/category/ajax/management.php"),e},value:null},dragdrop:{value:null}},t.prototype={categoriesinit:!1,initializer:function(){this.set("element","coursecat-management");var e=this.get("element"),t=e.one("#category-listing"),i=e.one("#course-listing"),o=null,n=null;t&&(o=t.one('.listitem[data-selected="1"]')),i&&(n=i.one('.listitem[data-selected="1"]')),this.set("categorylisting",t),this.set("courselisting",i),this.set("coursedetails",e.one("#course-detail")),o&&this.set("activecategoryid",o.getData("id")),n&&this.set("activecourseid",n.getData("id")),this.initialiseCategories(t),this.initialiseCourses(),i&&this.set("dragdrop",new s({console:this}))},initialiseCategories:function(e){var t,i,o;if(!e)return!1;(t=e.one("#menumovecategoriesto"))&&t.setAttribute("disabled",!0),(i=e.one("#menuresortcategoriesby"))&&i.setAttribute("disabled",!0),(o=e.one("#menuresortcoursesby"))&&o.setAttribute("disabled",!0),e.all(".listitem[data-id]").each(function(e){this.set("categories",new n({node:e,console:this})),0},this),this.categoriesinit||(this.get("categorylisting").delegate("click",this.handleCategoryDelegation,"a[data-action]",this),this.get("categorylisting").delegate("click",this.handleCategoryDelegation,'input[name="bcat[]"]',this),this.get("categorylisting").delegate("click",this.handleBulkSortByaction,"#menuselectsortby",this),this.categoriesinit=!0)},initialiseCourses:function(){var e,t=this.getCategoryById(this.get("activecategoryid")),i=this.get("courselisting");if(!i)return!1;(e=i.one("#menumovecoursesto"))&&e.setAttribute("disabled",!0),i.all(".listitem[data-id]").each(function(e){this.registerCourse(new o({node:e,console:this,category:t})),0},this),i.delegate("click",this.handleCourseDelegation,"a[data-action]",this),i.delegate("click",this.handleCourseDelegation,'input[name="bc[]"]',this)},registerCourse:function(e){var t=this.get("courses");t.push(e),this.set("courses",t)},handleCourseDelegation:function(e){var t=e.currentTarget,i=t.getData("action"),o=t.ancestor(".listitem").getData("id"),n=this.getCourseById(o);n&&n.handle(i,e)},handleCategoryDelegation:function(e){var t=e.currentTarget,i=t.getData("action"),o=t.ancestor(".listitem").getData("id"),n=this.getCategoryById(o);n&&n.handle(i,e)},isCourseSelected:function(e){var t,i,o,n=!1;if(e&&e.get("checked"))n=!0;else for(o=(i=this.get("courses")).length,t=0;t<o;t++)if(i.hasOwnProperty(t)&&i[t].get("node").one('input[name="bc[]"]').get("checked")){n=!0;break}return n},isCategorySelected:function(e){var t,i,o,n=!1;if(e&&e.get("checked"))n=!0;else for(o=(i=this.get("categories")).length,t=0;t<o;t++)if(i.hasOwnProperty(t)&&i[t].get("node").one('input[name="bcat[]"]').get("checked")){n=!0;break}return n},handleBulkSortByaction:function(e){var t=this.get("categorylisting").one("#menuresortcategoriesby"),i=this.get("categorylisting").one("#menuresortcoursesby"),o=this.get("categorylisting").one('input[name="bulksort"]'),n=e;n?e&&e.currentTarget&&(n=e.currentTarget):n=this.get("categorylisting").one("#menuselectsortby"),n&&(this.get("categories").length<=1||!this.isCategorySelected()&&"selectedcategories"===n.get("options").item(n.get("selectedIndex")).getAttribute("value")?(t&&t.setAttribute("disabled",!0),i&&i.setAttribute("disabled",!0),o&&o.setAttribute("disabled",!0)):(t&&t.removeAttribute("disabled"),i&&i.removeAttribute("disabled"),o&&o.removeAttribute("disabled")))},getCategoryById:function(e){var t,i,o=this.get("categories"),n=o.length;for(t=0;t<n;t++)if(o.hasOwnProperty(t)&&(i=o[t]).get("categoryid")===e)return i;return!1},getCourseById:function(e){var t,i,o=this.get("courses"),n=o.length;for(t=0;t<n;t++)if(o.hasOwnProperty(t)&&(i=o[t]).get("courseid")===e)return i;return!1},removeCourseById:function(e){var t,i=this.get("courses"),o=i.length;for(t=0;t<o;t++)if(i[t].get("courseid")===e){i.splice(t,1);break}},performAjaxAction:function(e,t,i,o){var n=new g.IO;t.action=e,t.ajax="1",t.sesskey=M.cfg.sesskey,null===i&&(i=function(){}),n.send(this.get("ajaxurl"),{method:"POST",on:{complete:i},context:o,data:t,arguments:t})}},g.extend(t,g.Base,t.prototype),M.clickap_program=M.clickap_program||{},M.clickap_program.management=M.clickap_program.management||{},M.clickap_program.management.console=null,M.clickap_program.management.init=function(e){M.clickap_program.management.console=new t(e)},s.NAME="moodle-clickap_program-management-dd",s.CSS_PREFIX="management-dd",s.ATTRS={console:{writeOnce:"initOnly"}},s.prototype={goingup:!1,lasty:null,previoussibling:null,initializer:function(){var e=this.get("console").get("element"),t=e.one("#category-listing"),i=e.one("#course-listing > .course-listing"),o=t?t.one("ul.ml"):null,n=i?i.one("ul.ml"):null,s=!!i&&i.getData("canmoveoutof"),r=s?e:n;if(!n)return!1;n.all("> li").each(
function(e){this.initCourseListing(e,r)},this),n.setData("dd",new g.DD.Drop({node:n})),s&&o&&o.all("li > div").each(function(e){this.initCategoryListitem(e)},this),g.DD.DDM.on("drag:start",this.dragStart,this),g.DD.DDM.on("drag:end",this.dragEnd,this),g.DD.DDM.on("drag:drag",this.dragDrag,this),g.DD.DDM.on("drop:over",this.dropOver,this),g.DD.DDM.on("drop:enter",this.dropEnter,this),g.DD.DDM.on("drop:exit",this.dropExit,this),g.DD.DDM.on("drop:hit",this.dropHit,this)},initCourseListing:function(e,t){e.setData("dd",new g.DD.Drag({node:e,target:{padding:"0 0 0 20"}}).addHandle(".drag-handle").plug(g.Plugin.DDProxy,{moveOnEnd:!1,borderStyle:!1}).plug(g.Plugin.DDConstrained,{constrain2node:t}))},initCategoryListitem:function(e){e.setData("dd",new g.DD.Drop({node:e}))},dragStart:function(e){var t=e.target,i=t.get("node"),o=t.get("dragNode");i.addClass("course-being-dragged"),o.addClass("course-being-dragged-proxy").set("innerHTML",i.one("a.coursename").get("innerHTML")),this.previoussibling=i.get("previousSibling")},dragEnd:function(e){e.target.get("node").removeClass("course-being-dragged"),this.get("console").get("element").all("#category-listing li.highlight").removeClass("highlight")},dragDrag:function(e){var t=e.target.lastXY[1];t<this.lasty?this.goingup=!0:this.goingup=!1,this.lasty=t},dropOver:function(e){var t=e.drag.get("node"),i=e.drop.get("node");if("li"===i.get("tagName").toLowerCase()&&i.hasClass("listitem-course")){if(!this.goingup&&!(i=i.get("nextSibling")))return(i=e.drop.get("node")).get("parentNode").append(t),!1;i.get("parentNode").insertBefore(t,i),e.drop.sizeShim()}},dropEnter:function(e){var t=e.drop.get("node");"div"===t.get("tagName").toLowerCase()&&t.ancestor("li.listitem-category").addClass("highlight")},dropExit:function(e){var t=e.drop.get("node");"div"===t.get("tagName").toLowerCase()&&t.ancestor("li.listitem-category").removeClass("highlight")},dropHit:function(e){var t,i,o,n,s,r,a,c=e.drag.get("node"),l=e.drop.get("node"),g=null!==l.ancestor(".listitem-category"),u=!g&&l.test(".listitem-course"),d=this.get("console");if(!c.test(".listitem-course"))return!1;o=c.getData("id"),g?(t=l.ancestor(".listitem-category").getData("id"),(i=d.getCategoryById(t))&&(n=d.getCourseById(o))&&i.moveCourseTo(n)):(u||l.ancestor("#course-listing"))&&(n=d.getCourseById(o),(s=(r=c.get("previousSibling"))&&r.getData("id")||0)!==(a=this.previoussibling?this.previoussibling.getData("id"):0)&&n.moveAfter(s,a))}},g.extend(s,g.Base,s.prototype),i.NAME="moodle-clickap_program-management-item",i.CSS_PREFIX="management-item",i.ATTRS={node:{},console:{},itemname:{value:"item"}},i.prototype={highlighttimeout:null,checkAjaxResponse:function(e,t,i){if(200!==t.status)return!1;if(null===e||null===i)return!1;var o=g.JSON.parse(t.responseText);return!1!==o.error&&new M.core.exception(o),!1!==o.outcome&&o},moveup:function(e,t,i){var o,n,s,r,a,c,l;if(!1===this.checkAjaxResponse(e,t,i))return!1;(r=(o=this.get("node")).previous(".listitem"))?(r.insert(o,"before"),a=r.one(" > div a.action-moveup"),s=o.one(" > div a.action-movedown"),a&&s||(n=o.one(" > div a.action-moveup"),c=r.one(" > div a.action-movedown"),a||s?s||n.insert(c,"after"):(l=g.Node.create('<a style="visibility:hidden;">&nbsp;</a>'),c.replace(l),n.replace(c),l.replace(n),l.destroy())),(n=o.one(" > div a.action-moveup"))?n.focus():(s=o.one(" > div a.action-movedown"))&&s.focus(),this.updated(!0)):window.location.reload()},movedown:function(e,t,i){var o,n,s,r,a,c,l;if(!1===this.checkAjaxResponse(e,t,i))return!1;(n=(o=this.get("node")).next(".listitem"))?(o.insert(n,"before"),c=n.one(" > div a.action-movedown"),s=o.one(" > div a.action-moveup"),c&&s||(a=n.one(" > div a.action-moveup"),r=o.one(" > div a.action-movedown"),c||s?s||r.insert(a,"before"):(l=g.Node.create('<a style="visibility:hidden;">&nbsp;</a>'),a.replace(l),r.replace(a),l.replace(r),l.destroy())),(r=o.one(" > div a.action-movedown"))?r.focus():(s=o.one(" > div a.action-moveup"))&&s.focus(),this.updated(!0)):window.location.reload()},show:function(e,t,i){var o;if(!1===this.checkAjaxResponse(e,t,i))return!1;this.markVisible(),(o=this.get("node").one("a[data-action=hide]"))&&o.focus(),this.updated()},markVisible:function(){return this.get("node").setAttribute("data-visible","1"),!0},hide:function(e,t,i){var o;if(!1===this.checkAjaxResponse(e,t,i))return!1;this.markHidden(),(o=this.get("node").one("a[data-action=show]"))&&o.focus(),this.updated()},markHidden:function(){return this.get("node").setAttribute("data-visible","0"),!0},updated:function(e){e&&this.highlight()},highlight:function(){var e=this.get("node");e.siblings(".highlight").removeClass("highlight"),e.addClass("highlight"),this.highlighttimeout&&window.clearTimeout(this.highlighttimeout),this.highlighttimeout=window.setTimeout(function(){e.removeClass("highlight")},2500)}},g.extend(i,g.Base,i.prototype),n.NAME="moodle-clickap_program-management-category",n.CSS_PREFIX="management-category",n.ATTRS={categoryid:{getter:function(e,t){return null===e&&(e=this.get("node").getData("id"),this.set(t,e)),e},value:null,writeOnce:!0},programid:{getter:function(e,t){return null===e&&(e=this.get("node").getData("programid"),this.set(t,e)),e},value:null,writeOnce:!0},selected:{getter:function(e,t){return null===e&&(null===(e=this.get("node").getData(t))&&(e=!1),this.set(t,e)),e},value:null},courses:{validator:function(e){return g.Lang.isArray(e)},value:[]}},n.prototype={initializer:function(){this.set("itemname","category")},getName:function(){return this.get("node").one("a.categoryname").get("innerHTML")},registerCourse:function(e){var t=this.get("courses");t.push(e),this.set("courses",t)},handle:function(e,t){var i,o,n={programid:this.get("programid"),categoryid:this.get("categoryid")},s=this.get("console").get("activecategoryid");switch(s&&s!==n.categoryid&&(n.selectedcategory=s),e){case"moveup":t.preventDefault(),this.get("console").performAjaxAction("movecategoryup",n,this.moveup,this);break;case"movedown":t.preventDefault(),this.get(
"console").performAjaxAction("movecategorydown",n,this.movedown,this);break;case"show":t.preventDefault(),this.get("console").performAjaxAction("showcategory",n,this.show,this);break;case"hide":t.preventDefault(),this.get("console").performAjaxAction("hidecategory",n,this.hide,this);break;case"expand":t.preventDefault(),"0"===this.get("node").getData("expanded")&&(this.get("node").setAttribute("data-expanded","1").setData("expanded","true"),this.get("console").performAjaxAction("getsubcategorieshtml",n,this.loadSubcategories,this)),this.expand();break;case"collapse":t.preventDefault(),this.collapse();break;case"select":(o=(i=this.get("console")).get("categorylisting").one("#menumovecategoriesto"))&&(i.isCategorySelected(t.currentTarget)&&1<i.get("categories").length?o.removeAttribute("disabled"):o.setAttribute("disabled",!0),i.handleBulkSortByaction());break;default:return!1}},expand:function(){var e=this.get("node"),t=e.one("a[data-action=expand]"),i=e.one("ul[role=group]");e.removeClass("collapsed").setAttribute("aria-expanded","true"),t.setAttribute("data-action","collapse").setAttrs({title:M.util.get_string("collapsecategory","moodle",this.getName())}).one("img").setAttrs({src:M.util.image_url("t/switch_minus","moodle"),alt:M.util.get_string("collapse","moodle")}),i&&i.setAttribute("aria-hidden","false"),this.get("console").performAjaxAction("expandcategory",{categoryid:this.get("categoryid")},null,this)},collapse:function(){var e=this.get("node"),t=e.one("a[data-action=collapse]"),i=e.one("ul[role=group]");e.addClass("collapsed").setAttribute("aria-expanded","false"),t.setAttribute("data-action","expand").setAttrs({title:M.util.get_string("expandcategory","moodle",this.getName())}).one("img").setAttrs({src:M.util.image_url("t/switch_plus","moodle"),alt:M.util.get_string("expand","moodle")}),i&&i.setAttribute("aria-hidden","true"),this.get("console").performAjaxAction("collapsecategory",{categoryid:this.get("categoryid")},null,this)},loadSubcategories:function(e,t,i){var o,n,s=this.checkAjaxResponse(e,t,i),r=this.get("node"),a=this.get("console");return!1!==s&&(r.append(s.html),a.initialiseCategories(r),M.core&&M.core.actionmenu&&M.core.actionmenu.newDOMNode&&M.core.actionmenu.newDOMNode(r),o=r.one("ul[role=group]"),n=r.one("a[data-action=collapse]"),o&&n&&n.setAttribute("aria-controls",o.generateID()),!0)},moveCourseTo:function(t){var i=this;g.use("moodle-core-notification-confirm",function(){var e=new M.core.confirm({title:M.util.get_string("confirm","moodle"),question:M.util.get_string("confirmcoursemove","moodle",{course:t.getName(),category:i.getName()}),yesLabel:M.util.get_string("move","moodle"),noLabel:M.util.get_string("cancel","moodle")});e.on("complete-yes",function(){e.hide(),e.destroy(),this.get("console").performAjaxAction("movecourseintocategory",{programid:this.get("programid"),categoryid:this.get("categoryid"),courseid:t.get("courseid")},this.completeMoveCourse,this)},i),e.show()})},completeMoveCourse:function(e,t,i){var o,n,s,r=this.checkAjaxResponse(e,t,i),a=this.get("console");return!1!==r&&(!!(n=a.getCourseById(i.courseid))&&(this.highlight(),n&&(r.paginationtotals&&(s=a.get("courselisting").one(".listing-pagination-totals"))&&s.set("innerHTML",r.paginationtotals),"undefined"!==r.totalcatcourses&&(s=this.get("node").one(".course-count span"))&&s.set("innerHTML",s.get("innerHTML").replace(/^\d+/,r.totalcatcourses)),"undefined"!=typeof r.fromcatcoursecount&&(o=a.get("activecategoryid"),(o=a.getCategoryById(o))&&(s=o.get("node").one(".course-count span"))&&s.set("innerHTML",s.get("innerHTML").replace(/^\d+/,r.fromcatcoursecount))),n.remove()),!0))},show:function(e,t,i){var o,n=this.checkAjaxResponse(e,t,i);if(!1===n)return!1;this.markVisible(),(o=this.get("node").one("a[data-action=hide]"))&&o.focus(),n.categoryvisibility&&this.updateChildVisibility(n.categoryvisibility),n.coursevisibility&&this.updateCourseVisiblity(n.coursevisibility),this.updated()},hide:function(e,t,i){var o,n=this.checkAjaxResponse(e,t,i);if(!1===n)return!1;this.markHidden(),(o=this.get("node").one("a[data-action=show]"))&&o.focus(),n.categoryvisibility&&this.updateChildVisibility(n.categoryvisibility),n.coursevisibility&&this.updateCourseVisiblity(n.coursevisibility),this.updated()},updateCourseVisiblity:function(e){var t,i,o=this.get("console");try{for(t in e)"object"==typeof e[t]&&(i=o.getCourseById(e[t].id))&&("1"===e[t].visible?i.markVisible():i.markHidden())}catch(n){}return this},updateChildVisibility:function(e){var t,i,o=this.get("console");try{for(t in e)"object"==typeof e[t]&&(i=o.getCategoryById(e[t].id))&&("1"===e[t].visible?i.markVisible():i.markHidden())}catch(n){}return this}},g.extend(n,i,n.prototype),o.NAME="moodle-clickap_program-management-course",o.CSS_PREFIX="management-course",o.ATTRS={courseid:{},selected:{getter:function(e,t){return null===e&&(e=this.get("node").getData(t),this.set(t,e)),e},value:null},node:{},console:{writeOnce:"initOnly"},category:{writeOnce:"initOnly"},programid:{getter:function(e,t){return null===e&&(e=this.get("node").getData("programid"),this.set(t,e)),e},value:null,writeOnce:!0},categoryid:{getter:function(e,t){return null===e&&(e=this.get("node").getData("categoryid"),this.set(t,e)),e},value:null,writeOnce:!0}},o.prototype={initializer:function(){var e=this.get("node"),t=this.get("category");this.set("courseid",e.getData("id")),t&&t.registerCourse&&t.registerCourse(this),this.set("itemname","course")},getName:function(){return this.get("node").one("a.coursename").get("innerHTML")},handle:function(e,t){var i,o,n=this.get("console"),s={programid:this.get("programid"),categoryid:this.get("categoryid"),courseid:this.get("courseid")};switch(e){case"moveup":t.halt(),n.performAjaxAction("movecourseup",s,this.moveup,this);break;case"movedown":t.halt(),n.performAjaxAction("movecoursedown",s,this.movedown,this);break;case"show":t.halt(),n.performAjaxAction("showcourse",s,this.show,this);break;case"hide":t.halt(),n.performAjaxAction("hidecourse",s,
this.hide,this);break;case"select":(o=(i=this.get("console")).get("courselisting").one("#menumovecoursesto"))&&(i.isCourseSelected(t.currentTarget)?o.removeAttribute("disabled"):o.setAttribute("disabled",!0));break;default:return!1}},remove:function(){this.get("console").removeCourseById(this.get("courseid")),this.get("node").remove()},moveAfter:function(e,t){var i=this.get("console"),o={programid:this.get("programid"),categoryid:this.get("categoryid"),courseid:this.get("courseid"),moveafter:e,previous:t};i.performAjaxAction("movecourseafter",o,this.moveAfterResponse,this)},moveAfterResponse:function(e,t,i){var o,n=this.checkAjaxResponse(e,t,i),s=this.get("node");if(!1===n)return(o=s.ancestor("ul").one("li[data-id="+i.previous+"]"))?o.insertAfter(s,"after"):s.ancestor("ul").one("li").insert(s,"before"),!1;this.highlight()}},g.extend(o,i,o.prototype)},"@VERSION@",{requires:["base","node","io-base","moodle-core-notification-exception","json-parse","dd-constrain","dd-proxy","dd-drop","dd-delegate","node-event-delegate"]});